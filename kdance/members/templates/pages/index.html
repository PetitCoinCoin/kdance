{% extends 'layouts/base.html' %}

{% load static %}

{% block content %}

<main>
  <section>
    <!-- Toasts -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="pwd-success-toast" class="toast align-items-center bg-info" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body fw-semibold">
            Mot de passe changé avec succès.
          </div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="user-error-toast" class="toast align-items-center bg-alert" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body fw-semibold" id="user-error-body"></div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <!-- Modal -->
    {% csrf_token %}
    <div class="modal fade" id="copy-member-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Renouveler un adhérent pour la nouvelle saison</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="form-outline">
              <label class="form-label" for="copy-member-select">Adhérent</label>
              <select id="copy-member-select" class="form-select"></select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button id="copy-btn" type="button" class="btn btn-info" {% if not allow_new_member %} disabled {% endif %}>Renouveler</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="delete-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="delete-modal-title">Supprimer un adhérent</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button id="delete-btn" type="submit" class="btn btn-danger">Supprimer</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="validate-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Valider mes inscriptions pour la saison</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-justify">
            <p>
              Après validation de votre inscription, toute modification, ajout, ou suppression de cours pour les
              adhérents inscrits devra se faire auprès de l'équipe K'Dance. Il ne sera plus possible de supprimer un
              adhérent.
            </p>
            <p>
              La validation définitive se fera à réception du paiement. A ce jour, le paiement en ligne n'est pas encore
              possible, mais vous pouvez voir facilement un statut de votre compte pour la saison en cours, et faire
              passer
              votre règlement à K'Dance lors du forum des associations ou des permanences qui auront lieu fin septembre.
            </p>
            <p>
              Le document médical, attestation sur l'honneur ou certificat, sera à remettre dès que possible de la même
              façon,
              ou auprès des professeurs.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button id="validate-btn" type="submit" class="btn btn-success">Valider</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="container">
      <div class="text-center">
        <h1 class="display-4 mb-3">Mon compte K'Dance</h1>
      </div>
      {% if user.is_authenticated %}
      <div class="container">
        <div class="row mb-3">
          <div class="col-10 col-sm">
            <dl class="row">
              <dt class="col-sm-3">Email:</dt>
              <dd id="desc-email" class="col-sm-9"></dd>
              <dt class="col-sm-3">Prénom:</dt>
              <dd id="desc-firstname" class="col-sm-9"></dd>
              <dt class="col-sm-3">Nom:</dt>
              <dd id="desc-lastname" class="col-sm-9"></dd>
              <dt class="col-sm-3">Téléphone:</dt>
              <dd id="desc-phone" class="col-sm-9"></dd>
              <dt class="col-sm-3">Adresse:</dt>
              <dd id="desc-address" class="col-sm-9"></dd>
            </dl>
          </div>
          <div class="col-1">
            <span class="d-inline-block" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
              data-bs-content="Modifier mes infos" data-bs-placement="left">
              <button class="btn btn-outline-info" type="button" onclick="window.location='/user_edit'">
                <i class="bi-pencil-fill"></i>
              </button>
            </span>
            <span class="d-inline-block" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
              data-bs-content="Modifier mon mot de passe" data-bs-placement="left">
              <button class="btn btn-outline-warning" type="button" onclick="window.location='/user_edit_pwd'">
                <i class="bi-lock-fill"></i>
              </button>
            </span>
            <span class="d-inline-block" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
              data-bs-content="Supprimer mon compte" data-bs-placement="left">
              <button id="delete-me-btn" class="btn btn-outline-danger" type="button" onclick="window.location='/user_delete'">
                <i class="bi-trash3-fill"></i>
              </button>
            </span>
          </div>
        </div>
        <div class="mb-4">
          <p>Pour commencer l'inscription, cliquez sur <span class="main-blue fst-italic">Ajouter un nouvel
              adhérent</span> dans la
            saison en cours. Recommencez pour chaque adhérent de la famille.<br />
            Lorsque tout le monde est inscrit et que les cours sont choisis, vous pourrez <span
              class="main-green fst-italic">Valider les inscriptions</span>.
          </p>
          <p class="fst-italic">Pour en savoir un peu plus sur ce nouvel outil, <a href="/about">cliquez ici</a>.</p>
          {% if not allow_new_member %}
            <p>Les inscriptions sont terminées pour cette année. <strong>Vous ne pouvez plus ajouter d'adhérent.</strong></p>
          {% endif %}
        </div>
        <div class="row">
          <div class="accordion" id="member-accordion">
          </div>
        </div>
      </div>

      <!-- Template -->
      <template id="accordion-item-template">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" aria-expanded="true">
              <span>Saison</span>
            </button>
          </h2>
          <div class="accordion-collapse collapse show template-data">
            <div class="accordion-body">
              <div class="row mb-3">
                <div class="col-12 col-sm-8">
                  <dl class="d-flex mb-0">
                    <dt class="me-2">Total dû:</dt>
                    <dd class="payment">€</dd>
                  </dl>
                  <dl class="d-flex mb-0">
                    <dt class="me-2">Payé:</dt>
                    <dd class="payment">€</dd>
                  </dl>
                  <dl class="d-flex mb-2">
                    <dt class="me-2">Remboursement perçu:</dt>
                    <dd class="payment">€</dd>
                  </dl>
                </div>
                <div class="season-btn-div d-flex flex-column col-12 col-sm-4"></div>
              </div>
            </div>
          </div>
        </div>
      </template>

      <template id="card-template">
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between">
            <div>
              <img height="30">
              <span></span>
            </div>
            <div>
              <button class="btn btn-outline-info m-edit-btn" type="button">
                <i class="bi-pencil-fill"></i>
              </button>
              <button class="btn btn-outline-danger m-delete-btn" type="button" data-bs-toggle="modal"
                data-bs-target="#delete-modal">
                <i class="bi-trash3-fill"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <ul></ul>
          </div>
        </div>
      </template>

      <template id="member-btn-template">
        <button class="btn btn-info mb-1" type="button" data-bs-toggle="modal" data-bs-target="#copy-member-modal"
          id="copy-member-btn" {% if not allow_new_member %} disabled {% endif %}>
          <i class="bi-plus-square"></i>
          Ajouter un adhérent d'une saison précédente
        </button>
        <button class="btn btn-info mb-1" type="button" onclick="window.location='/member'"
          id="add-member-btn" {% if not allow_new_member %} disabled {% endif %}>
          <i class="bi-plus-square"></i>
          Ajouter un nouvel adhérent
        </button>

        <button class="btn btn-success" type="button" data-bs-toggle="modal" data-bs-target="#validate-modal"
          id="validate-members-btn" {% if not allow_new_member %} disabled {% endif %}>
          <i class="bi-file-earmark-check-fill"></i>
          Valider les inscriptions
        </button>
      </template>

      <template id="member-doc-template">
        <br />
        <li class="list-group-item">
          <i></i> Autorisation d'utilisation des photos
        </li>
        <li class="list-group-item">
          <i></i> Autorisation parentale
        </li>
        <li class="list-group-item">
          <i></i>
        </li>
      </template>

      <template id="contact-template">
        <div>
          <div class="row flex-wrap align-items-end">
            <div class="col">
              <div class="form-outline mb-4">
                <label class="form-label required" for="firstname-">Prénom</label>
                <input type="text" id="firstname-" class="form-control" />
              </div>
            </div>
            <div class="col">
              <div class="form-outline mb-4">
                <label class="form-label required" for="lastname-">Nom de famille</label>
                <input type="text" id="lastname-" class="form-control" />
              </div>
            </div>
            <div class="col-3">
              <div class="form-outline mb-4">
                <label class="form-label required" for="phone-">Téléphone</label>
                <input type="text" id="phone-" maxlength="10" class="form-control" />
                <div id="invalid-phone-" class="invalid-feedback"></div>
              </div>
            </div>
            <div class="col-3">
              <div class="form-outline mb-4">
                <label class="form-label required" for="email-">Email</label>
                <input type="text" id="email-" class="form-control" />
                <div id="invalid-email-" class="invalid-feedback"></div>
              </div>
            </div>
          </div>
        </div>
      </template>

      <template id="add-contact-template">
        <div class="col-1 mb-4">
          <button class="btn btn-outline-info" type="button">
            <i class="bi-plus-square"></i>
          </button>
        </div>
      </template>

      <template id="remove-contact-template">
        <div class="col-1 mb-4">
          <button class="btn btn-outline-danger" type="button">
            <i class="bi-trash3-fill"></i>
          </button>
        </div>
      </template>

      {% endif %}
    </div>
  </section>
  <script type="text/javascript">
    const userMeUrl = "{% url 'api-user-me' %}";
    const userMeValidateUrl = "{% url 'api-user-me-validate' %}";
    const membersUrl = "{% url 'api-members-list' %}";
    const settingsUrl = "{% url 'api-settings-detail' %}";
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  </script>
  <script src="{% static 'js/user.js' %}"></script>
</main>

{% endblock content %}
